window.wmJs={Models:{},Collections:{},Views:{},Routers:{},init:function(){"use strict";var a=new wmJs.Views.ApplicationManagerView(window.Stubs.testData());a.render()}},$(document).ready(function(){"use strict";wmJs.init()}),window.WM=window.WM||{},window.WM.defaults={id:null,state:{},factoryKey:"blank_window",display:"blank window",affixed:!1,draggable:!0,visible:!0,height:200,width:200,left:50,top:50},window.WM.BlankWindowFactory=function(){var a=0;return{mkWindow:function(b){a++;var c=b||{};return{id:a,display:"blank window "+a,affixed:c.affixed||!1,draggable:c.draggable||!0,visible:c.visible||!0,height:c.height||200,width:c.width||200,left:c.left||50,top:c.top||50,state:{},factoryKey:c.factoryKey||"blank_window",instance:null}}}}(),window.WM.applyMissingConfig=function(a){a.id=a.id||WM.defaults.id,a.state=a.state||WM.defaults.state,a.display=a.display||WM.defaults.display,a.affixed=a.affixed||WM.defaults.affixed,a.draggable=a.draggable||WM.defaults.draggable,a.visible=a.visible||WM.defaults.visible,a.height=a.height||WM.defaults.height,a.width=a.width||WM.defaults.width,a.left=a.left||WM.defaults.left,a.top=a.top||WM.defaults.top},window.WM.Exception={},window.WM.Exception.ConfigPropertyMissing=function(a){throw new Error("Configuration Property Missing: "+a)},window.WM.topics={visibilityChanged:"visibilityChanged",workspaceChanged:"workspaceChanged",worspaceSaved:"workspaceSaved",viewInitialized:"viewInitialized",workspaceLoaded:"workspaceLoaded",workspaceWindowsLoaded:"workspaceWindowsLoaded",workspaceRenderAll:"workspaceRenderAll"},window.WM=window.WM||{},window.WM.WindowedApplicationFactory=function(){var a={};return{getWindowedApplication:function(b,c){var d=a[b];return d?new d(c):null},registerApplication:function(b,c){var d=c.prototype;return d.window_render&&d.windowTemplate&&(a[b]=c),WM.WindowedApplicationFactory}}}(),this.JST=this.JST||{},this.JST["app/scripts/templates/application_manager.ejs"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+="<p></p>\n\n";return __p},this.JST["app/scripts/templates/application_window.ejs"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="window default-window">\n	<div class="row">\n		<div class="btn-group pull-right">\n               <button type="button" class="btn-pin btn-window-action btn btn-link">\n               	<span class="glyphicon glyphicon-pushpin"></span>\n               </button>\n               <button type="button" class="btn-draggable btn-window-action btn btn-link">\n               	<span class="glyphicon glyphicon-hand-up"></span>\n               </button>\n               <button type="button" class="btn-close btn-window-action btn btn-link">\n               	<span class="glyphicon glyphicon-remove-circle"></span>\n               </button>\n        </div>\n	</div>\n	<div class="window-content resizable-content">\n	</div>\n	<hr />\n</div>\n';return __p},this.JST["app/scripts/templates/window_blank.ejs"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="blank-window"></div>\n\n';return __p},wmJs.Views=wmJs.Views||{},function(){"use strict";wmJs.Views.ApplicationManagerView=Backbone.View.extend({currentWorkspace:null,template:JST["app/scripts/templates/application_manager.ejs"],registerSubscriptions:function(){$.subscribe(WM.topics.viewInitialized,_.partial(this.workspaceInit,this)),$.subscribe(WM.topics.workspaceLoaded,_.partial(this.windowsInit,this)),$.subscribe(WM.topics.workspaceWindowsLoaded,_.partial(this.viewReady,this))},initialize:function(a){a||WM.Exception.ConfigPropertyMissing("initialize"),this.WorkspaceConfig=a.WorkspaceConfig||WM.Exception.ConfigPropertyMissing("WorkspaceConfig"),this.WindowFactory=a.WindowFactory||WM.Exception.ConfigPropertyMissing("WindowFactory"),this.WindowConfigList=a.WindowConfigList||WM.Exception.ConfigPropertyMissing("WindowConfigList"),this.currentWorkspace=this.WorkspaceConfig.id||null,this.registerSubscriptions()},render:function(){$.publish(WM.topics.viewInitialized)},workspaceInit:function(a){if("undefined"==typeof a.WorkspaceConfig.url)return void $.publish(WM.topics.workspaceLoaded);var b=a.WorkspaceConfig.url(a.currentWorkspace);return wsId instanceof Object?(a.WorkspaceConfig.data=b,void $.publish(WM.topics.workspaceLoaded)):void $.when($.ajax({url:a.WorkspaceConfig.url(a.currentWorkspace)})).then(function(b){a.WorkspaceConfig.data=b,$.publish(WM.topics.workspaceLoaded)},function(a){console.log(a)})},windowsInit:function(a){return"undefined"==typeof a.WindowConfigList.url?void $.publish(WM.topics.workspaceWindowsLoaded):void $.when($.ajax({url:a.WindowConfigList.url(a.currentWorkspace)})).then(function(b){a.WindowConfigList.data=b,$.publish(WM.topics.workspaceWindowsLoaded)},function(a){console.log(a)})},viewReady:function(a){a.$el.html(""),a.applyWorkspaceConfiguration(),a.WindowConfigList.data.forEach(function(b){b.instance=a.WindowFactory(b.factoryKey,{parentView:a.el,config:b}),a.$el.append(b.instance.el),b.instance.render({resetTemplate:!0})})},applyWorkspaceConfiguration:function(){this.$el.css("width",this.WorkspaceConfig.width).css("height",this.WorkspaceConfig.height)}})}(),wmJs.Views=wmJs.Views||{},function(){"use strict";var a=function(a){this.config=a.config,this.$parentView=$(a.parentView),Backbone.View.apply(this,[a])};_.extend(a.prototype,Backbone.View.prototype,{windowTemplate:JST["app/scripts/templates/application_window.ejs"],window_events_base:{"click .btn-pin":"btnPinClickHandler","click .btn-draggable":"btnDragClickHandler","click .btn-close":"windowCloseHandler"},render:function(a){var b=this;if(a.resetTemplate&&b.$el.html(b.windowTemplate()),b.$windowcontainer=b.$el.find(".window"),b.$btnPin=b.$el.find(".btn-pin"),b.$btnDraggable=b.$el.find(".btn-draggable"),b.$windowcontent=$(b.$el.find(".window-content")[0]),!b.$windowcontent.length)throw new Error(".window content doesn't exist");b.window_render(a),b.$windowcontainer.draggable({containment:b.$parentView,disabled:!1,drag:function(a,c){b.config.left=c.position.left,b.config.top=c.position.top}}),b.$windowcontent.resizable({resize:function(){var a=$(this);b.config.height=a.height(),b.config.width=a.width()}}),this.applyConfiguration()},events:function(){return _.extend({},this.window_events_base,this.window_events)},applyConfiguration:function(){this.$windowcontent.css("height",this.config.height).css("width",this.config.width),this.$windowcontainer.css("left",this.config.left).css("top",this.config.top),this.config.affixed?(this.$windowcontainer.css("position","fixed"),this.deactivate(this.$btnPin)):(this.$windowcontainer.css("position","absolute"),this.activate(this.$btnPin)),this.config.draggable?(this.$windowcontainer.draggable({disabled:!1}),this.activate(this.$btnDraggable)):(this.$windowcontainer.draggable({disabled:!0}),this.deactivate(this.$btnDraggable)),this.config.visible||this.$windowcontainer.hide()},btnPinClickHandler:function(){var a=this.$windowcontainer.css("position");"fixed"==a?(this.$windowcontainer.css("position","absolute"),this.activate(this.$btnPin),this.config.affixed=!1):(this.$windowcontainer.css("position","fixed"),this.deactivate(this.$btnPin),this.config.affixed=!0)},btnDragClickHandler:function(){var a=this.$windowcontainer.draggable("option","disabled");a?(this.$windowcontainer.draggable({disabled:!1}),this.activate(this.$btnDraggable),this.config.draggable=!0):(this.$windowcontainer.draggable({disabled:!0}),this.deactivate(this.$btnDraggable),this.config.draggable=!1)},activate:function(a){a.addClass("btn-default").removeClass("btn-link")},deactivate:function(a){a.addClass("btn-link").removeClass("btn-default")}}),a.extend=Backbone.View.extend,wmJs.ApplicationWindowView=wmJs.ApplicationWindowView||{},wmJs.ApplicationWindowView=a}(),wmJs.Views=wmJs.Views||{},function(){"use strict";wmJs.Views.WindowBlankView=wmJs.ApplicationWindowView.extend({template:JST["app/scripts/templates/window_blank.ejs"],window_render:function(){this.$windowcontent.html(this.template())}}),WM.WindowedApplicationFactory.registerApplication("blank_window",wmJs.Views.WindowBlankView)}();